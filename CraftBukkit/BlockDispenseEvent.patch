From fe6cc5eac9706cf5f0662ae19f952bb8249543a9 Mon Sep 17 00:00:00 2001
From: YukonAppleGeek <yukonvinecki@gmail.com>
Date: Wed, 3 Apr 2013 17:40:57 -0700
Subject: [PATCH 2244/2244] Add getEntity to BlockDispenseEvent

---
 src/main/java/net/minecraft/server/DispenseBehaviorArmor.java    |    2 +-
 src/main/java/net/minecraft/server/DispenseBehaviorBoat.java     |    5 +++--
 src/main/java/net/minecraft/server/DispenseBehaviorBonemeal.java |    2 +-
 .../java/net/minecraft/server/DispenseBehaviorEmptyBucket.java   |    2 +-
 .../java/net/minecraft/server/DispenseBehaviorFilledBucket.java  |    2 +-
 src/main/java/net/minecraft/server/DispenseBehaviorFireball.java |    6 ++++--
 .../java/net/minecraft/server/DispenseBehaviorFireworks.java     |    6 ++++--
 .../java/net/minecraft/server/DispenseBehaviorFlintAndSteel.java |    2 +-
 src/main/java/net/minecraft/server/DispenseBehaviorItem.java     |    3 ++-
 src/main/java/net/minecraft/server/DispenseBehaviorMinecart.java |    6 ++++--
 .../java/net/minecraft/server/DispenseBehaviorMonsterEgg.java    |    5 +++--
 .../java/net/minecraft/server/DispenseBehaviorProjectile.java    |    2 +-
 src/main/java/net/minecraft/server/DispenseBehaviorTNT.java      |    6 ++++--
 13 files changed, 30 insertions(+), 19 deletions(-)

diff --git a/src/main/java/net/minecraft/server/DispenseBehaviorArmor.java b/src/main/java/net/minecraft/server/DispenseBehaviorArmor.java
index 1c50ad4..75c175c 100644
--- a/src/main/java/net/minecraft/server/DispenseBehaviorArmor.java
+++ b/src/main/java/net/minecraft/server/DispenseBehaviorArmor.java
@@ -30,7 +30,7 @@ final class DispenseBehaviorArmor extends DispenseBehaviorItem {
             org.bukkit.block.Block block = world.getWorld().getBlockAt(isourceblock.getBlockX(), isourceblock.getBlockY(), isourceblock.getBlockZ());
             CraftItemStack craftItem = CraftItemStack.asCraftMirror(itemstack1);
 
-            BlockDispenseEvent event = new BlockDispenseEvent(block, craftItem.clone(), new org.bukkit.util.Vector(0, 0, 0));
+            BlockDispenseEvent event = new BlockDispenseEvent(block, craftItem.clone(), new org.bukkit.util.Vector(0, 0, 0), null);
             if (!BlockDispenser.eventFired) {
                 world.getServer().getPluginManager().callEvent(event);
             }
diff --git a/src/main/java/net/minecraft/server/DispenseBehaviorBoat.java b/src/main/java/net/minecraft/server/DispenseBehaviorBoat.java
index 8e3a861..90e61ce 100644
--- a/src/main/java/net/minecraft/server/DispenseBehaviorBoat.java
+++ b/src/main/java/net/minecraft/server/DispenseBehaviorBoat.java
@@ -37,8 +37,9 @@ final class DispenseBehaviorBoat extends DispenseBehaviorItem {
         ItemStack itemstack1 = itemstack.a(1);
         org.bukkit.block.Block block = world.getWorld().getBlockAt(isourceblock.getBlockX(), isourceblock.getBlockY(), isourceblock.getBlockZ());
         CraftItemStack craftItem = CraftItemStack.asCraftMirror(itemstack1);
+        EntityBoat entityboat = new EntityBoat(world, d0, d1 + d3, d2);
 
-        BlockDispenseEvent event = new BlockDispenseEvent(block, craftItem.clone(), new org.bukkit.util.Vector(d0, d1 + d3, d2));
+        BlockDispenseEvent event = new BlockDispenseEvent(block, craftItem.clone(), new org.bukkit.util.Vector(d0, d1 + d3, d2), entityboat.getBukkitEntity());
         if (!BlockDispenser.eventFired) {
             world.getServer().getPluginManager().callEvent(event);
         }
@@ -59,7 +60,7 @@ final class DispenseBehaviorBoat extends DispenseBehaviorItem {
             }
         }
 
-        EntityBoat entityboat = new EntityBoat(world, event.getVelocity().getX(), event.getVelocity().getY(), event.getVelocity().getZ());
+        entityboat.setPosition(event.getVelocity().getX(), event.getVelocity().getY(), event.getVelocity().getZ());
         // CraftBukkit end
 
         world.addEntity(entityboat);
diff --git a/src/main/java/net/minecraft/server/DispenseBehaviorBonemeal.java b/src/main/java/net/minecraft/server/DispenseBehaviorBonemeal.java
index 54c590b..9a445ef 100644
--- a/src/main/java/net/minecraft/server/DispenseBehaviorBonemeal.java
+++ b/src/main/java/net/minecraft/server/DispenseBehaviorBonemeal.java
@@ -24,7 +24,7 @@ final class DispenseBehaviorBonemeal extends DispenseBehaviorItem {
             org.bukkit.block.Block block = world.getWorld().getBlockAt(isourceblock.getBlockX(), isourceblock.getBlockY(), isourceblock.getBlockZ());
             CraftItemStack craftItem = CraftItemStack.asCraftMirror(itemstack1);
 
-            BlockDispenseEvent event = new BlockDispenseEvent(block, craftItem.clone(), new org.bukkit.util.Vector(0, 0, 0));
+            BlockDispenseEvent event = new BlockDispenseEvent(block, craftItem.clone(), new org.bukkit.util.Vector(0, 0, 0), null);
             if (!BlockDispenser.eventFired) {
                 world.getServer().getPluginManager().callEvent(event);
             }
diff --git a/src/main/java/net/minecraft/server/DispenseBehaviorEmptyBucket.java b/src/main/java/net/minecraft/server/DispenseBehaviorEmptyBucket.java
index 8f7e09b..d20d41d 100644
--- a/src/main/java/net/minecraft/server/DispenseBehaviorEmptyBucket.java
+++ b/src/main/java/net/minecraft/server/DispenseBehaviorEmptyBucket.java
@@ -35,7 +35,7 @@ final class DispenseBehaviorEmptyBucket extends DispenseBehaviorItem {
         org.bukkit.block.Block block = world.getWorld().getBlockAt(i, j, k);
         CraftItemStack craftItem = CraftItemStack.asCraftMirror(itemstack);
 
-        BlockDispenseEvent event = new BlockDispenseEvent(block, craftItem.clone(), new org.bukkit.util.Vector(0, 0, 0));
+        BlockDispenseEvent event = new BlockDispenseEvent(block, craftItem.clone(), new org.bukkit.util.Vector(0, 0, 0), null);
         if (!BlockDispenser.eventFired) {
             world.getServer().getPluginManager().callEvent(event);
         }
diff --git a/src/main/java/net/minecraft/server/DispenseBehaviorFilledBucket.java b/src/main/java/net/minecraft/server/DispenseBehaviorFilledBucket.java
index daf50a9..5ee67d8 100644
--- a/src/main/java/net/minecraft/server/DispenseBehaviorFilledBucket.java
+++ b/src/main/java/net/minecraft/server/DispenseBehaviorFilledBucket.java
@@ -27,7 +27,7 @@ final class DispenseBehaviorFilledBucket extends DispenseBehaviorItem {
             org.bukkit.block.Block block = world.getWorld().getBlockAt(i, j, k);
             CraftItemStack craftItem = CraftItemStack.asCraftMirror(itemstack);
 
-            BlockDispenseEvent event = new BlockDispenseEvent(block, craftItem.clone(), new org.bukkit.util.Vector(x, y, z));
+            BlockDispenseEvent event = new BlockDispenseEvent(block, craftItem.clone(), new org.bukkit.util.Vector(x, y, z), null);
             if (!BlockDispenser.eventFired) {
                 world.getServer().getPluginManager().callEvent(event);
             }
diff --git a/src/main/java/net/minecraft/server/DispenseBehaviorFireball.java b/src/main/java/net/minecraft/server/DispenseBehaviorFireball.java
index 1cb73aa..5a19a5a 100644
--- a/src/main/java/net/minecraft/server/DispenseBehaviorFireball.java
+++ b/src/main/java/net/minecraft/server/DispenseBehaviorFireball.java
@@ -27,8 +27,9 @@ final class DispenseBehaviorFireball extends DispenseBehaviorItem {
         ItemStack itemstack1 = itemstack.a(1);
         org.bukkit.block.Block block = world.getWorld().getBlockAt(isourceblock.getBlockX(), isourceblock.getBlockY(), isourceblock.getBlockZ());
         CraftItemStack craftItem = CraftItemStack.asCraftMirror(itemstack1);
+        EntitySmallFireball entitysmallfireball = new EntitySmallFireball(world, d0, d1, d2, d3, d4, d5);
 
-        BlockDispenseEvent event = new BlockDispenseEvent(block, craftItem.clone(), new org.bukkit.util.Vector(d3, d4, d5));
+        BlockDispenseEvent event = new BlockDispenseEvent(block, craftItem.clone(), new org.bukkit.util.Vector(d3, d4, d5), entitysmallfireball.getBukkitEntity());
         if (!BlockDispenser.eventFired) {
             world.getServer().getPluginManager().callEvent(event);
         }
@@ -49,7 +50,8 @@ final class DispenseBehaviorFireball extends DispenseBehaviorItem {
             }
         }
 
-        world.addEntity(new EntitySmallFireball(world, d0, d1, d2, event.getVelocity().getX(), event.getVelocity().getY(), event.getVelocity().getZ()));
+        entitysmallfireball.setDirection(event.getVelocity().getX(), event.getVelocity().getY(), event.getVelocity().getZ());
+        world.addEntity(entitysmallfireball);
         // itemstack.a(1); // Handled during event processing
         // CraftBukkit end
 
diff --git a/src/main/java/net/minecraft/server/DispenseBehaviorFireworks.java b/src/main/java/net/minecraft/server/DispenseBehaviorFireworks.java
index 6141b44..7277bcd 100644
--- a/src/main/java/net/minecraft/server/DispenseBehaviorFireworks.java
+++ b/src/main/java/net/minecraft/server/DispenseBehaviorFireworks.java
@@ -20,8 +20,9 @@ final class DispenseBehaviorFireworks extends DispenseBehaviorItem {
         ItemStack itemstack1 = itemstack.a(1);
         org.bukkit.block.Block block = world.getWorld().getBlockAt(isourceblock.getBlockX(), isourceblock.getBlockY(), isourceblock.getBlockZ());
         CraftItemStack craftItem = CraftItemStack.asCraftMirror(itemstack1);
+        EntityFireworks entityfireworks = new EntityFireworks(isourceblock.k(), d0, d1, d2, itemstack1);
 
-        BlockDispenseEvent event = new BlockDispenseEvent(block, craftItem.clone(), new org.bukkit.util.Vector(d0, d1, d2));
+        BlockDispenseEvent event = new BlockDispenseEvent(block, craftItem.clone(), new org.bukkit.util.Vector(d0, d1, d2), entityfireworks.getBukkitEntity());
         if (!BlockDispenser.eventFired) {
             world.getServer().getPluginManager().callEvent(event);
         }
@@ -43,7 +44,8 @@ final class DispenseBehaviorFireworks extends DispenseBehaviorItem {
         }
 
         itemstack1 = CraftItemStack.asNMSCopy(event.getItem());
-        EntityFireworks entityfireworks = new EntityFireworks(isourceblock.k(), event.getVelocity().getX(), event.getVelocity().getY(), event.getVelocity().getZ(), itemstack1);
+        entityfireworks.setPosition(event.getVelocity().getX(), event.getVelocity().getY(), event.getVelocity().getZ());
+        entityfireworks.setEquipment(0, itemstack1);
 
         isourceblock.k().addEntity(entityfireworks);
         // itemstack.a(1); // Handled during event processing
diff --git a/src/main/java/net/minecraft/server/DispenseBehaviorFlintAndSteel.java b/src/main/java/net/minecraft/server/DispenseBehaviorFlintAndSteel.java
index 6fc910b..e2280b9 100644
--- a/src/main/java/net/minecraft/server/DispenseBehaviorFlintAndSteel.java
+++ b/src/main/java/net/minecraft/server/DispenseBehaviorFlintAndSteel.java
@@ -22,7 +22,7 @@ final class DispenseBehaviorFlintAndSteel extends DispenseBehaviorItem {
         org.bukkit.block.Block block = world.getWorld().getBlockAt(isourceblock.getBlockX(), isourceblock.getBlockY(), isourceblock.getBlockZ());
         CraftItemStack craftItem = CraftItemStack.asCraftMirror(itemstack);
 
-        BlockDispenseEvent event = new BlockDispenseEvent(block, craftItem.clone(), new org.bukkit.util.Vector(0, 0, 0));
+        BlockDispenseEvent event = new BlockDispenseEvent(block, craftItem.clone(), new org.bukkit.util.Vector(0, 0, 0), null);
         if (!BlockDispenser.eventFired) {
             world.getServer().getPluginManager().callEvent(event);
         }
diff --git a/src/main/java/net/minecraft/server/DispenseBehaviorItem.java b/src/main/java/net/minecraft/server/DispenseBehaviorItem.java
index c3a9f36..94f7e52 100644
--- a/src/main/java/net/minecraft/server/DispenseBehaviorItem.java
+++ b/src/main/java/net/minecraft/server/DispenseBehaviorItem.java
@@ -2,6 +2,7 @@ package net.minecraft.server;
 
 // CraftBukkit start
 import org.bukkit.craftbukkit.inventory.CraftItemStack;
+import org.bukkit.entity.Entity;
 import org.bukkit.event.block.BlockDispenseEvent;
 // CraftBukkit end
 
@@ -52,7 +53,7 @@ public class DispenseBehaviorItem implements IDispenseBehavior {
         org.bukkit.block.Block block = world.getWorld().getBlockAt(isourceblock.getBlockX(), isourceblock.getBlockY(), isourceblock.getBlockZ());
         CraftItemStack craftItem = CraftItemStack.asCraftMirror(itemstack);
 
-        BlockDispenseEvent event = new BlockDispenseEvent(block, craftItem.clone(), new org.bukkit.util.Vector(entityitem.motX, entityitem.motY, entityitem.motZ));
+        BlockDispenseEvent event = new BlockDispenseEvent(block, craftItem.clone(), new org.bukkit.util.Vector(entityitem.motX, entityitem.motY, entityitem.motZ), (Entity) entityitem);
         if (!BlockDispenser.eventFired) {
             world.getServer().getPluginManager().callEvent(event);
         }
diff --git a/src/main/java/net/minecraft/server/DispenseBehaviorMinecart.java b/src/main/java/net/minecraft/server/DispenseBehaviorMinecart.java
index 2a7b4ad..6719b09 100644
--- a/src/main/java/net/minecraft/server/DispenseBehaviorMinecart.java
+++ b/src/main/java/net/minecraft/server/DispenseBehaviorMinecart.java
@@ -37,8 +37,9 @@ final class DispenseBehaviorMinecart extends DispenseBehaviorItem {
         ItemStack itemstack1 = itemstack.a(1);
         org.bukkit.block.Block block = world.getWorld().getBlockAt(isourceblock.getBlockX(), isourceblock.getBlockY(), isourceblock.getBlockZ());
         CraftItemStack craftItem = CraftItemStack.asCraftMirror(itemstack1);
+        EntityMinecartAbstract entityminecartabstract = EntityMinecartAbstract.a(world, d0, d1 + d3, d2, ((ItemMinecart) itemstack1.getItem()).a);
 
-        BlockDispenseEvent event = new BlockDispenseEvent(block, craftItem.clone(), new org.bukkit.util.Vector(d0, d1 + d3, d2));
+        BlockDispenseEvent event = new BlockDispenseEvent(block, craftItem.clone(), new org.bukkit.util.Vector(d0, d1 + d3, d2), entityminecartabstract.getBukkitEntity());
         if (!BlockDispenser.eventFired) {
             world.getServer().getPluginManager().callEvent(event);
         }
@@ -60,7 +61,8 @@ final class DispenseBehaviorMinecart extends DispenseBehaviorItem {
         }
 
         itemstack1 = CraftItemStack.asNMSCopy(event.getItem());
-        EntityMinecartAbstract entityminecartabstract = EntityMinecartAbstract.a(world, event.getVelocity().getX(), event.getVelocity().getY(), event.getVelocity().getZ(), ((ItemMinecart) itemstack1.getItem()).a);
+        entityminecartabstract.setPosition(event.getVelocity().getX(), event.getVelocity().getY(), event.getVelocity().getZ());
+        entityminecartabstract.setEquipment(((ItemMinecart) itemstack1.getItem()).a, itemstack1);
         // CraftBukkit end
 
         world.addEntity(entityminecartabstract);
diff --git a/src/main/java/net/minecraft/server/DispenseBehaviorMonsterEgg.java b/src/main/java/net/minecraft/server/DispenseBehaviorMonsterEgg.java
index a29b550..6345d4e 100644
--- a/src/main/java/net/minecraft/server/DispenseBehaviorMonsterEgg.java
+++ b/src/main/java/net/minecraft/server/DispenseBehaviorMonsterEgg.java
@@ -20,8 +20,9 @@ final class DispenseBehaviorMonsterEgg extends DispenseBehaviorItem {
         ItemStack itemstack1 = itemstack.a(1);
         org.bukkit.block.Block block = world.getWorld().getBlockAt(isourceblock.getBlockX(), isourceblock.getBlockY(), isourceblock.getBlockZ());
         CraftItemStack craftItem = CraftItemStack.asCraftMirror(itemstack1);
+        Entity entity = ItemMonsterEgg.a(isourceblock.k(), itemstack.getData(), d0, d1, d2);
 
-        BlockDispenseEvent event = new BlockDispenseEvent(block, craftItem.clone(), new org.bukkit.util.Vector(d0, d1, d2));
+        BlockDispenseEvent event = new BlockDispenseEvent(block, craftItem.clone(), new org.bukkit.util.Vector(d0, d1, d2), entity.getBukkitEntity());
         if (!BlockDispenser.eventFired) {
             world.getServer().getPluginManager().callEvent(event);
         }
@@ -44,7 +45,7 @@ final class DispenseBehaviorMonsterEgg extends DispenseBehaviorItem {
 
         itemstack1 = CraftItemStack.asNMSCopy(event.getItem());
 
-        Entity entity = ItemMonsterEgg.a(isourceblock.k(), itemstack.getData(), event.getVelocity().getX(), event.getVelocity().getY(), event.getVelocity().getZ());
+        entity.setPosition(event.getVelocity().getX(), event.getVelocity().getY(), event.getVelocity().getZ());
 
         if (entity instanceof EntityLiving && itemstack.hasName()) {
             ((EntityLiving) entity).setCustomName(itemstack.getName());
diff --git a/src/main/java/net/minecraft/server/DispenseBehaviorProjectile.java b/src/main/java/net/minecraft/server/DispenseBehaviorProjectile.java
index 916ce14..e82b8e9 100644
--- a/src/main/java/net/minecraft/server/DispenseBehaviorProjectile.java
+++ b/src/main/java/net/minecraft/server/DispenseBehaviorProjectile.java
@@ -20,7 +20,7 @@ public abstract class DispenseBehaviorProjectile extends DispenseBehaviorItem {
         org.bukkit.block.Block block = world.getWorld().getBlockAt(isourceblock.getBlockX(), isourceblock.getBlockY(), isourceblock.getBlockZ());
         CraftItemStack craftItem = CraftItemStack.asCraftMirror(itemstack1);
 
-        BlockDispenseEvent event = new BlockDispenseEvent(block, craftItem.clone(), new org.bukkit.util.Vector((double) enumfacing.c(), (double) ((float) enumfacing.d() + 0.1F), (double) enumfacing.e()));
+        BlockDispenseEvent event = new BlockDispenseEvent(block, craftItem.clone(), new org.bukkit.util.Vector((double) enumfacing.c(), (double) ((float) enumfacing.d() + 0.1F), (double) enumfacing.e()), ((Entity) iprojectile).getBukkitEntity());
         if (!BlockDispenser.eventFired) {
             world.getServer().getPluginManager().callEvent(event);
         }
diff --git a/src/main/java/net/minecraft/server/DispenseBehaviorTNT.java b/src/main/java/net/minecraft/server/DispenseBehaviorTNT.java
index 950d9e9..24bc438 100644
--- a/src/main/java/net/minecraft/server/DispenseBehaviorTNT.java
+++ b/src/main/java/net/minecraft/server/DispenseBehaviorTNT.java
@@ -20,8 +20,10 @@ final class DispenseBehaviorTNT extends DispenseBehaviorItem {
         ItemStack itemstack1 = itemstack.a(1);
         org.bukkit.block.Block block = world.getWorld().getBlockAt(isourceblock.getBlockX(), isourceblock.getBlockY(), isourceblock.getBlockZ());
         CraftItemStack craftItem = CraftItemStack.asCraftMirror(itemstack1);
+        EntityTNTPrimed entitytntprimed = new EntityTNTPrimed(world, i + 0.5, j + 0.5, k + 0.5, (EntityLiving) null);
 
-        BlockDispenseEvent event = new BlockDispenseEvent(block, craftItem.clone(), new org.bukkit.util.Vector(i + 0.5, j + 0.5, k + 0.5));
+
+        BlockDispenseEvent event = new BlockDispenseEvent(block, craftItem.clone(), new org.bukkit.util.Vector(i + 0.5, j + 0.5, k + 0.5), entitytntprimed.getBukkitEntity());
         if (!BlockDispenser.eventFired) {
             world.getServer().getPluginManager().callEvent(event);
         }
@@ -42,7 +44,7 @@ final class DispenseBehaviorTNT extends DispenseBehaviorItem {
             }
         }
 
-        EntityTNTPrimed entitytntprimed = new EntityTNTPrimed(world, event.getVelocity().getX(), event.getVelocity().getY(), event.getVelocity().getZ(), (EntityLiving) null);
+        entitytntprimed.setPosition(event.getVelocity().getX(), event.getVelocity().getY(), event.getVelocity().getZ());
         // CraftBukkit end
 
         world.addEntity(entitytntprimed);
-- 
1.7.10.2 (Apple Git-33)

